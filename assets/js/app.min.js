
const delay=400
window.addEventListener('DOMContentLoaded',function(){const menu=document.querySelector('.header__menu')
const header=document.querySelector('.header')
const profileMenu=document.querySelector('.profile-menu')
let lock=false
const burger=document.querySelector('.header__burger')
if(burger){burger.addEventListener('click',function(){if(lock)return
lock=true
toggleMenu()
setTimeout(()=>{lock=false},delay)})
function toggleMenu(){burger.classList.toggle('active')
menu.classList.toggle('active')
header.classList.toggle('active')
lockBody()}}
const searchHeaderInput=document.querySelector('.search-header__input input')
const searchHeaderButton=document.querySelector('.header__search-button')
const emptySearchBlock=document.querySelector('.search-header__empty')
const contentSearchBlock=document.querySelector('.search-header__content')
const clearSearchHeader=document.querySelector('.search-header__clear')
const buttonSearchHeader=document.querySelector('.search-header__button')
const cancelSearchHeader=document.querySelector('.search-header__cancel')
const searchHeader=document.querySelector('.header__search')
if(menu){menu.addEventListener('click',function(e){if(!e.target.closest('.menu__body')){toggleMenu()}})}
if(searchHeaderButton){searchHeaderButton.addEventListener('click',function(e){if(menu.classList.contains('active')){toggleMenu()}
if(searchHeader.classList.contains('active')){searchHeader.classList.remove('active')
lockBody()}else{searchHeader.classList.add('active')
searchHeaderInput.focus()}
lockBody()
e.stopPropagation()})
header.addEventListener('click',function(e){if(document.querySelector('.search-header').classList.contains('active')&&!e.target.closest('.search-header')){searchHeader.classList.remove('active')
lockBody()}})
clearSearchHeader.addEventListener('click',function(){searchHeaderInput.value=''
searchHeaderInput.focus()
checkSearchInputValue()})
searchHeaderInput.addEventListener('input',checkSearchInputValue)
buttonSearchHeader.addEventListener('click',function(){searchHeaderInput.focus()})
cancelSearchHeader.addEventListener('click',function(){searchHeader.classList.remove('active')
lockBody()})}
function checkSearchInputValue(){if(searchHeaderInput.value.length===0&&emptySearchBlock.classList.contains('hidden')){emptySearchBlock.classList.remove('hidden')
contentSearchBlock.classList.remove('show')}
if(searchHeaderInput.value.length!==0&&!emptySearchBlock.classList.contains('hidden')){emptySearchBlock.classList.add('hidden')
contentSearchBlock.classList.add('show')}}
if(header&&profileMenu){header.addEventListener('click',function(e){if(profileMenu.classList.contains('active')&&(!e.target.closest('.profile-menu__body')&&!e.target.closest('.header__user')&&!e.target.closest('.bottom-header__item_user'))){profileMenu.classList.remove('active')
e.preventDefault()}
if(e.target.closest('.header__user')||e.target.closest('.bottom-header__item_user')){profileMenu.classList.toggle('active')
e.preventDefault()}})}
const feed=document.querySelector('.feed')
if(feed){feed.addEventListener('mousemove',debounce(playVideo,2))
let lockActiveVideo=false
let activeVideo=null
function playVideo(e){if(lockActiveVideo)return
if(e.target.closest('.video')&&!e.target.closest('.video').classList.contains('active')){const video=e.target.closest('.video').querySelector('video')
e.target.closest('.video').classList.add('active')
if(!video)return
activeVideo=video
activeVideo.play()
lockActiveVideo=true
e.target.closest('.video').addEventListener('mouseleave',function(e){resetActiveVideo()
setTimeout(function(){lockActiveVideo=false},70)},{once:true})}}
function resetActiveVideo(){if(activeVideo){activeVideo.pause();activeVideo.currentTime=0
activeVideo.closest('.video').classList.remove('active')
activeVideo=null}}
feed.addEventListener('touchstart',function(e){function detectOffset(e){if(!e.target.closest('.video'))return
if(e.target.closest('.video').classList.contains('active')){resetActiveVideo()
return}
e.preventDefault()
resetActiveVideo()
e.target.closest('.video').classList.add('active')
activeVideo=e.target.closest('.video').querySelector('video')
activeVideo.play()}
e.currentTarget.addEventListener('touchmove',debounce(detectOffset,50),{once:true})})
const gridButton=document.querySelector('.view-feed__item_grid')
const listButton=document.querySelector('.view-feed__item_list')
if(gridButton){gridButton.addEventListener('click',function(e){const items=document.querySelectorAll('.feed-items')
if(items.length>0){for(let index=0;index<items.length;index++){const item=items[index]
if(item.classList.contains('list')){item.classList.remove('list')}}
listButton.classList.remove('active')
gridButton.classList.add('active')}})}
if(listButton){listButton.addEventListener('click',function(e){const items=document.querySelectorAll('.feed-items')
if(items.length>0){for(let index=0;index<items.length;index++){const item=items[index]
if(!item.classList.contains('list')){item.classList.add('list')}}
listButton.classList.add('active')
gridButton.classList.remove('active')}})}}
window.addEventListener('click',function(e){if(e.target.closest('.modal')){if(!e.target.closest('.modal__content')){e.target.closest('.modal').classList.remove('active')
setTimeout(function(){lockBody()},300)}}
if(e.target.closest('.auth__signup')){e.target.closest('.auth').querySelector('.auth__button[data-tab-title="signup"]').classList.add('active')}})})